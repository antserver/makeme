<!-- BeginDsi "dsi/head.html" -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedthis Bit 0.8.0 Documentation</title>
    <meta name="keywords" content="Bit, Build It!, Javascript"/>
	<meta name="description" content="Embedthis Bit -- Fast, modern replacement for make and autoconf."/>
	<meta name="robots" content="index,follow" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    </![endif]-->
    <link href="http://www.google.com/cse/style/look/default.css" type="text/css" rel="stylesheet" />
</head>

<body>
    <div class="top">
        <a class="logo"  href="http://embedthis.com/">&nbsp;</a>
        <div class="topRight">
            <div class="search">
                <div id="cse-search-form">Loading</div>
                <div class='version'>Embedthis Bit 0.8.0</div>
            </div>
        </div>
        <div class="crumbs">
            <a href="../../../index.html">Home</a>
<!-- EndDsi -->
             &gt;<a href="index.html">User Guide</a>&gt; <b>Compiling and Creating Libraries</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            
                <h1>Quick Nav </h1>
                <ul>
<li><a href="#overview">Overview</a></li>
                </ul>
<!-- BeginDsi "dsi/guideSeeAlso.html" -->
        <h1>See Also</h1>
        <ul>
            <li><a href="../../../guide/bit/users/quick.html">Quick Start with Bit</a></li>
            <li><a href="../../../guide/bit/users/projects.html">Bit Projects</a></li>
            <li><a href="../../../guide/bit/users/compiling.html">Compiling Sources</a></li>
            <li><a href="../../../guide/bit/users/executables.html">Building Executables</a></li>
            <li><a href="../../../guide/bit/users/scripts.html">Running Scripts</a></li>
            <li><a href="../../../guide/bit/users/copying.html">Copying Files</a></li>
            <li><a href="../../../guide/bit/users/configuring.html">Configuring a Project</a></li>
            <li><a href="../../../guide/bit/users/debugging.html">Debugging a Build</a></li>
            <li><a href="../../../guide/bit/users/generating.html">Generating Projects</a></li>
            <li><a href="../../../guide/bit/users/make.html">Using Makefiles</a></li>
            <li><a href="../../../guide/bit/users/cross.html">Cross-Compiling</a></li>

            <li><a href="../../../guide/bit/users/http://ejscript.org/products/ejs/doc/api/ejscript/index.html">Ejscript Language</a></li>
            <li><a href="../../../guide/bit/users/http://ejscript.org/products/ejs/doc/index.html">Ejscript Documentation</a></li>
        </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
        <h2>Compiling and Creating Libraries</h2>
        <p>Bit compiles sources by defining library targets to for the compiled objects. These libraries may be used
        to build executables, or just to hold the objects.
        <p>To define a library, create a library target in the targets collection of a bit file.
<pre>
targets {
    libname: {
        type: 'lib',
        sources: '*.c',
    },
}
</pre>
        
        <p>Set the target <em>type</em> property to 'lib' and select the source files to compile via the
        <em>sources</em> property.
        <p>Building this target will then automatically compile all the specified source files and then build
        the named library containing the relevant compiled objects.</p>
        <p>Bit automatically creates targets for each of the compiled source files and for any include files referenced
        by the sources. If the source file is updated, the file will be recompiled and library rebuilt when bit is next
        run. If any of the included headers are updated, the file and library will similarly be rebuilt.</p>
        <h2>Selecting Source Files</h2>
        <p>The <em>sources</em> property may be set to a regular expression, a string or an array of either. Further,
        multiple sources properties can be aggregated by prefixing source array properties with <em>+</em>. For example: 
<pre>
sources: /view-.*\.c|image.*\.c/,
</pre>
        <p>This will select any C source files starting with 'view-' or 'image' in the current directory.</p>
<pre>
sources: ['*.c', '*.cpp'],
</pre>
        <p>This will select C and C++ source files in the current directory.</p>
<pre>
sources: '**.c',
</pre>
        <p>This will select C and C++ source files in the current directory or in any sub-directory below.</p>
        <h3>Excluding Items</h3>
        <p>You can also exclude specific items from the sources list. Similar to the sources property, the 
        <em>exclude</em> property can be set to a regular expression, a string or an array of either. Once
        the list of sources is built from the sources property, each qualifying source file is checked to see if
        it should be excluded. The exclusion match is performed on the entire source file name.</p>
        <pre>
sources: '**.c',
<b>exclude: /\/test$|\/demo$'</b>,
</pre>
        <p>This will exclude C files in the test and demo directories. If using regular expressions, make sure you 
        include a leading '\/' and trailing '$' if you want to match a directory basename.</p>
        <h2>Static Libraries</h2>
        <p>By default, a shared library will be built. To build a static library, set the 
                <i>static</i> property to true.</p>
<pre>
libname: {
    type: 'lib',
    sources: '*.c',
    static: true,
},
</pre>
        <h2>Useful Options</h2>
        <p>Bit has some useful options that help diagnose common build issues.</p>
        <h3>Tracing executed commands</h3>
        <p>To see the actual commands bit is executing to compile sources and link libraries, run bit with the
        <em>--show</em> switch (this can be abbreviated to -s).
<pre>$ bit <b>-s</b>
   [Compile] src/deps/mpr/mprSsl.c
       [Run] /usr/bin/clang -c -o macosx-x64-release/obj/mprSsl.o -arch x86_64 \
             -Wall -Wno-deprecated-declarations -O3 -Wno-unused-result \
             -Wshorten-64-to-32 -DEMBEDTHIS=1 -Imacosx-x64-release/inc \
             src/deps/mpr/mprSsl.c
      [Link] libmprssl
</pre>
        <h3>Why a build is or is not happening</h3>
        <p>Sometimes, it is not obvious why a target, either source file or library is continually being rebuilt.
        Othertimes, a target is not being built and it is difficult to understand why? Bit provides a <em>--why</em>
        switch which will trace why each target was or was not built. For example:
        <pre>$ bit <b>--why</b> libmpr
    [Target] /Users/mob/git/bit/macosx-x64-release/inc/mpr.h is up to date
    [Target] /Users/mob/git/bit/macosx-x64-release/inc/bit.h is up to date
    [Target] /Users/mob/git/bit/macosx-x64-release/inc/bitos.h is up to date
   [Rebuild] /Users/mob/git/bit/macosx-x64-release/obj/mprLib.o because input \
             /Users/mob/git/bit/src/deps/mpr/mprLib.c has been modified.
   [Compile] src/deps/mpr/mprLib.c
   [Rebuild] /Users/mob/git/bit/macosx-x64-release/bin/libmpr.dylib because input \
             /Users/mob/git/bit/macosx-x64-release/obj/mprLib.o has been modified.
      [Link] libmpr
</pre>
        <h3>Exactly how is Bit interpreting a target</h3>
        <p>You can dump the entire Bit understand of your build via the <em>--dump</em> switch. This will save to 
        an OS-ARCH-PROFILE.dmp a complete internal snapshot of the Bit definition of your projects. This cannot be
        run, but is great for seeing how bit is expanding your project definition.</p>
        <pre>$ bit <b>--dump</b></pre>
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->
	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2013. 
            All rights reserved. Embedthis Bit, Ejscript and Appweb are trademarks of Embedthis Software LLC.</a>
		</p>
	</div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> 
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
        var customSearchControl = new google.search.CustomSearchControl(
          'partner-pub-9935546676162772:ysvxxv4n9rx');

        customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
        var options = new google.search.DrawOptions();
        options.enableSearchboxOnly("http://embedthis.com/search.html");
        customSearchControl.draw('cse-search-form', options);
      }, true);
    </script>
</body>
</html>
