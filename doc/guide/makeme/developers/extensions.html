<!-- BeginDsi "dsi/head.html" -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedthis MakeMe 0.8.0 Documentation</title>
    <meta name="keywords" content="MakeMe, Bit, GYP, autoconf"/>
	<meta name="description" content="Embedthis MakeMe -- Fast, modern replacement for make and autoconf."/>
	<meta name="robots" content="index,follow" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    </![endif]-->
    <link href="http://www.google.com/cse/style/look/default.css" type="text/css" rel="stylesheet" />
</head>

<body>
    <div class="top">
        <a class="logo"  href="http://embedthis.com/">&nbsp;</a>
        <div class="topRight">
            <div class="search">
                <div id="cse-search-form">Loading</div>
                <div class="version">Embedthis MakeMe 0.8.0</div>
            </div>
        </div>
        <div class="crumbs">
            <a href="../../../index.html">Home</a>
<!-- EndDsi -->
             &gt;<a href="index.html">Developer Guide</a>&gt; <b>Creating Project Extensions</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            
                <h1>Quick Nav </h1>
                <ul>
                    <li><a href="#configure">Creating</a></li>
                </ul>
<!-- BeginDsi "dsi/devSeeAlso.html" -->
            <h1>See Also</h1>
            <ul>
                <li><a href="../../../guide/makeme/developers/index.html">Dev Guide</a></li>
                <li><a href="../../../guide/makeme/developers/projects.html">MakeMe Projects</a></li>
                <li><a href="../../../guide/makeme/developers/compiling.html">Compiling Sources</a></li>
                <li><a href="../../../guide/makeme/developers/libraries.html">Creating Libraries</a></li>
                <li><a href="../../../guide/makeme/developers/executables.html">Building Executables</a></li>
                <li><a href="../../../guide/makeme/developers/scripts.html">Running Scripts</a></li>
                <li><a href="../../../guide/makeme/developers/copying.html">Copying Files</a></li>
                <li><a href="../../../guide/makeme/developers/main.html">Creating Main.me</a></li>
                <li><a href="../../../guide/makeme/developers/extensions.html">Creating Project Extensions</a></li>
                <li><a href="../../../guide/makeme/developers/generating.html">Generating Projects</a></li>
                <li><a href="../../../guide/makeme/developers/samples.html">MakeMe Samples</a></li>

                <li><a href="http://ejscript.org/products/ejs/doc/api/ejscript/index.html">Ejscript Language</a></li>
                <li><a href="http://ejscript.org/products/ejs/doc/index.html">Ejscript Documentation</a></li>
            </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
        <h1>Creating Project Extensions</h1>
        <p>A project built by MakeMe, may be extended by the discovery and inclusion of extensions. These are modules that
        contribute programs, libraries, files or other components to your project to extend core functionality. Examples are:
        the <a href="http://embedthis.com/products/esp/">ESP</a> web framework, OpenSSL SSL stack, or simple tools like the 
        doxygen documentation generator.</p>
        <p>Extensions are located and defined when users first run <em>configure</em> before building the product. To locate
        extensions, MakeMe uses extension <em>probes</em> that are MakeMe scripts to locate and configure the extension.
   
        <h2>Specifying Extensions</h2>
        <p>In the project's <em>main.me</em> file, you specify the set of possible extensions. For example:</p>
<pre>
settings: {
    extensions: {
        require:  [ 'pcre' ],
        discover: [ 'cgi', 'dir', 'doxygen', 'dsi', 'esp', 'est', 'php', 'sqlite'],
        omit:     [ 'openssl' ],
    }
},
</pre>
        <p>Extensions are designated as either <em>required</em>, <em>discoverable</em> or <em>omitted</em>. 
        Required extensions are essential for the basic operation of the product. Discoverable extensions are optional
        extensions for which MakeMe will search the local system to see if the extension is present. Omitted extensions
        will not be automatically discovered and must be explicitly requested by the user when configuring via the
        <em>--with</em> switch. For example:</p> 
        <pre>
configure -with EXTENSION
configure -with EXTENSION=/path/to/extension</pre>
        <h2>Extension Probes</h2>
        <p>Extensions are located and configured via special MakeMe files called extension probes. 
        An extension probe may be defined via:
        <ul>
            <li>MakeMe probe file under the project's <em>makeme/probes</em> directory</li>
            <li>Probe property collection in an extension delivered using <a href="http://embedthis.com/products/pak/">Pak</a>.</li>
        </ul>
        <p>When the probe is run, it searches for the extension to test if the extension is available on the system. If found,
        MakeMe creates a definition for the extension in the platform MakeMe file in the <em>me.extensions</em> collection
        that fully describes the extension, its location and how to build with it. 
        This definition is also created as a target in <em>me.targets</em> so that any build target can depend upon the 
        extension to inherit its build settings.</p>
        <h2>Standard Probes</h2>
        <p>Here is a partial list of the standard extension probes supplied with MakeMe.</p>
        <table title="extensions">
        <thead>
        <tr><th>Extension</th><th>Description</th></tr>
        </thead>
        <tbody>
            <tr><td>compilermeme</td><td>Compiler detection</td></tr>
            <tr><td>doxygen.me</td><td>Doxygen documentation generator</td></tr>
            <tr><td>ejs.me</td><td>Ejscript shell tool</td></tr>
            <tr><td>est.me</td><td>Embedded Security Transport (SSL)</td></tr>
            <tr><td>http.me</td><td>Http command tool</td></tr>
            <tr><td>lib.me</td><td>Library archive program (ar, lib)</td></tr>
            <tr><td>link.me</td><td>Linker program</td></tr>
            <tr><td>man.me</td><td>Man page tool</td></tr>
            <tr><td>man2html.me</td><td>Man page to HTML tool</td></tr>
            <tr><td>matrixssl.me</td><td>MatrixSSL (SSL)</td></tr>
            <tr><td>md5.me</td><td>MD5 checksum tool</td></tr>
            <tr><td>nanossl.me</td><td>Mocana NanoSSL (SSL)</td></tr>
            <tr><td>openssl.me</td><td>OpenSSL (SSL)</td></tr>
            <tr><td>pcre.me</td><td>PCRE regular expression library</td></tr>
            <tr><td>pmaker.me</td><td>Package maker tool (PackageMaker, rpmbuild, InnoSetup)</td></tr>
            <tr><td>ranlib.me</td><td>Ranlib tool</td></tr>
            <tr><td>rc.me</td><td>Resource compiler tool on windows</td></tr>
            <tr><td>sqlite.me</td><td>SQLite library</td></tr>
            <tr><td>ssl.me</td><td>SSL Support</td></tr>
            <tr><td>strip.me</td><td>Strip tool</td></tr>
            <tr><td>tidy.me</td><td>HTML tidy program</td></tr>
            <tr><td>utest.me</td><td>Ejscript unit test framework</td></tr>
            <tr><td>vxworks.me</td><td>WindRiver VxWorks Development Environment</td></tr>
            <tr><td>winsdk.me</td><td>Windows SDK</td></tr>
            <tr><td>zip.me</td><td>Zip command tool</td></tr>
            <tr><td>zlib.me</td><td>Zlib library</td></tr>
            </tbody>
        </table>
        <h2>Packaging Extensions</h2>
        <p>Project extensions may be delivered via one of two mechanisms:</p>
        <ul>
            <li>Stand-alone probe script in the project/makeme/probes directory</li>
            <li>Extension Pak under src/paks directory</li>
            <li>MakeMe provides a standard set of probes for common extensions.</li>
        </ul>
        <h2>Stand-Alone Probes</h2>
        <p>If an extension's resources are already on the user's system, such as a system library or command line utility, 
        the exension may be simply located and configured via a stand-alone probe script. For example:
<pre>
Me.extension({
    myssl: {
        description: 'MySSL',
        path: function (extension) {
            let path = extension.withpath || Path('/usr/lib/myssl')
            if (!path.exists) {
                throw 'Cannot find MySSL'
            }
            extension.includes =  [ path.join('include') ]
            extension.libraries = [ 'myssl' ]
            extension.libpaths =  [ path.join('lib') ]
            return path
        },
        extensions: [ 'ssl' ],
    },
})
</pre>
        <p>This probe searches first for the extension at a location supplied via configure:</p>
        <pre>configure --with myssl=/usr/home/dev/myssl</pre>
        <p>If that fails, it checks the standard system location <em>/usr/lib/myssl</em>.
        <p>If the extension is located, the libraries and compilation include paths are defined for the extension. 
        Targets will inherit these automatically if the extension is configured.</p>
        <h2>Extension Paks</h2>
        <p>Extensions can be conveniently packaged and delivered using the 
        <a href="http://embedthis.com/products/pak">Pak</a> tool. Pak is a package manager and distribution tool
        for distributing application components. These may then be delivered either as part of the project, 
       or they may be separately downloaded and installed by the user just prior to configuring. </p>
        <p>Extension packs may define their probe script inline via the extension's MakeMe build file. If a Pak omits to
        define a probe, then a default probe is created for the extension automatically by MakeMe.</p>
        <p>For example: </p>
        <pre>
{
    probe: {
        myssl: {
            description: 'MySSL',
            path: function (extension) {
                let path = extension.withpath || Path('/usr/lib/myssl')
                if (!path.exists) {
                    throw 'Cannot find MySSL'
                }
                extension.includes =  [ path.join('include') ]
                extension.libraries = [ 'myssl' ]
                extension.libpaths =  [ path.join('lib') ]
                return path
            },
            extensions: [ 'ssl' ],
        },
    }
}
</pre>
        <h2>Probe Properties</h2>
        <p>The extension probe may contain properties of any name, but the following properties have special meaning:</p>
        <ul>
            <li>config &mdash; Function run to define extension properties.</li>
            <li>description &mdash; Short, one-sentance description of the extension.</li>
            <li>defines &mdash; Array of C preprocessor definitions for targets using this extension.</li>
            <li>depends &mdash; Array of targets from which to inherit compiler, defines, libraries, libpaths and linker
            settings. May contain extension names.</li>
            <li>discover &mdash; Array of other extensions that should be discovered and utilized by this extension if
                available.</li>
            <li>enable &mdash; Boolean true|false value to enable or disable the extension. May be initially set to a script or
            function that is run to yield a boolean result.  
            <li>generate &mdash; Function to run to define extension properties when generating projects.</li>
            <li>imports &mdash; Libraries, files and resources to import into the local source tree.</li>
            <li>includes &mdash; Array of include paths necessary for targets using this extension.</li>
            <li>libpaths &mdash; Array of linker library search paths for targets using this extension.</li>
            <li>libraries &mdash; Array of required libraries for targets using this extension.</li>
            <li>linker &mdash; Array of linker options for targets using this extension.</li>
            <li>name &mdash; Extension name. Should equal the extension collection property name..</li>
            <li>extensions &mdash; Array of other extensions that must be available for this extension to be enabled.</li>
            <li>path &mdash; Path to primary extension resource or directory. May be the path to the binary for tools.</li>
        </ul>
        <h2>Using Extensions in Targets</h2>
        <p>If a target specifies an extension in its <em>depends</em> property, and the extension is found and
        enabled, then the extension properties: defines, includes, libraries, linker and libpaths, will be inherited by the
        target. </p>
        <p>If the target specifies the extension via its <em>extensions</em> property the target will only be built if the
        extension is enabled. Otherwise, the target will (silently) be omitted from the build. </p>
        <p>For example, consider the earlier MySSL extension definition, then a target desiring to use this php extension
         could be specified like this:</p>
<pre>
app: {
    type: 'exe',
    sources: 'app.c',
    <b>depends: ['myssl']</b>,
    <b>extensions: ['myssl']</b>,
},
</pre>
        <p>MakeMe will automatically import the libmyssl library into the local tree at configure time. Because of the
        <em>depends</em> property, MakeMe will add the <em>libmyssl</em> when linking the executable.</p>
        <a name="api"></a>
        <h2>Extension API</h2>
        <p>An extension is defined by creating properties in the MakeMe DOM. For probe scripts, the
        <a href="../../../api/makeme/me.html#extension">Me.extension</a> API is used. This takes a set of properties that
        describes the extension including the name of the extension, and a short, single-line description for the extension. </p>
<pre>
<b>Me.extension({</b>
    mydemo: {
        description: 'My demo',
        path: '/usr/local/myview,
    },
})
</pre>
        <p>The extension will typically define a path which represents the directory to the extension or the path to
        the primary program of the extension. The description may also provide libraries, library paths, compiler 
        definitions, and include directories.
        An extension may define any of these standard properties, or it may define any custom property it chooses.
        For example:</p>
<pre>
Me.extension({
    ejs: {
        description: 'Ejscript Language',
        path: probe('src/deps/ejs/ejsLib.c'),
        <b>libraries: [ 'mpr', 'http', 'pcre' ],
        defines: [ 'EJS_DEBUG' ],
        favoriteColor: 'blue',</b>
    },
})
</pre>
        <h3>Extension Path</h3>
        <p>The extension path should be the filename of the program if the extension represents a simple tool (like zip). 
        Otherwise, it should be the directory to the extension if it represents something more complex like an SDK. The
        path may be a simple string or path, or it may be a function that returns the path for the extension. If
        path is set to a function, it will be invoked with the extension object as its argument. For example:</p>
        <pre>
Me.extension({
    lib: {
        description: 'Library Archive Tool',
        path: function (extension) {
            return probe('ar', { fullpath: true, search: me.extensions.compiler.search })
        },
        extensions: ['compiler'],
    },
})
</pre>
        <p>The <a href="../../../api/makeme/global.html#probe">probe</a> API may be used to search the system for a program or
        extension resource. See below for more details.  Note that the probe API may nested inside a
        function or it may be directly assigned to the path property. For example:</p>
        <pre>
Me.extension({
    lib: {
        description: 'Library Archive Tool',
        <b>path: probe('ar', { fullpath: true })</b>
    },
})
</pre>
        <p>If configure is run and an extension is explicitly requested with a path, that path is provided to the extension in
            its <em>extension.withpath</em> property. For example:</p>
        <pre>me -configure . -with NAME=/path</pre>
        <p>The extension script can then access the requested path via <em>extension.withpath</em>. A common pattern for 
            probing for extension resources is to use the <em>withpath</em> as the default before probing:</p>
            <pre>path: function (extension) {
    return probe(extension.withpath || '/usr/local/bin/programName')
},  
</pre>
        <h3>Exceptions</h3>
        <p>If an exception is thrown by any code in the extension probe, the exception will be caught and the extension will be
        disabled. This is a common pattern, to throw exceptions if the extension cannot be fully configured and enabled.</p>
        <h3>The <a href="../../../api/makeme/global.html#program">program()</a> API</h3>
        <p>If you wish to create an extension for a simple command line tool, use the <em>program</em> function to 
            search and define the tool. This works if the tool is accessible using the current PATH definition.
<pre>Me.program('zip', 'Zip utility')</pre>
            <p>The program function searches for Zip and defines the extension if zip can be found.</p>
            <h3>The <a href="../../../api/makeme/global.html#probe">probe()</a> API</h3>
        <p>The probe function is useful to search for a program on the system. It searches for a named program
        and takes options for the search path (search), the default to return if the program cannot be found (default), and
        whether to return the full path or just the dirname portion (fullpath).</p>
         
<pre>probe('gzip', { 
    search: ['/bin', '/usr/bin' ],
    default: 'bin/gzip'
})
</pre>
        <h2>Importing Standard Extensions</h2>
        <p>For developers who wish to <i>freeze</i> the MakeMe support for their product and guarantee the version
        of MakeMe they have designed for, the MakeMe configuration can be imported into the product source tree via:</p>
        <pre>me -import</pre>
        <p>This will copy the entire MakeMe <em>makeme</em> directory into the local source. This copied configuration
        will be used by MakeMe in preference over the install MakeMe files.  The various MakeMe extensions and operating system
        configuration can be modified once imported.</p>
        <p>Under the <em>makeme</em> directory will be the primary MakeMe script <em>me.es</em> and its compiled form
        <em>me.mod</em>. If you need to hack me.es, remove the me.mod file and MakeMe will utilize your modifications.
        When ready, you can compile me.es to create a new me.mod via:</p>
        <pre>/usr/local/bin/makeme/latest/bin/ejsc --optimize 9 --out me.mod me.es</pre>
        <a name="samples"></a>
        <h2>Samples</h2>
        <p>The standard extension probes are a good source of samples for how to create extension probes. 
        View in the repository at 
            <a href="https://github.com/embedthis/makeme/tree/master/makeme/probes">MakeMe Extensions Probes</a>.</p>
        <h2>Generating Projects</h2>
        <p>When generating conditional Makefiles, an extension cannot know in advance what resources will be available on
            the system where the Makefile will be run. So the extension script cannot sleuth the system to determine the
            appropriate configuration. MakeMe addresses the conundrum, by providing a separate <em>generate</em> 
            property. This may be set to a function that is invoked for the extension to create a default configuration.</p>
            <p>For example, this defines a generic MatrixSSL configuration. When the user runs the Makefile, they
                can supply the path to MatrixSSL via the ME_EXT_MATRIXSSL_PATH make variable.</p>
            <pre>
matrixssl: {
    generate: function (ext) {
        ext.path = 'PLEASE-SET:ME_EXT_MATRIXSSL_PATH'
        ext.libpaths = [ '$(ME_EXT_MATRIXSSL_PATH)' ]
        ext.includes = [ 
            '$(ME_EXT_MATRIXSSL_PATH)', 
            '$(ME_EXT_MATRIXSSL_PATH)/matrixssl' 
        ]
        if (me.platform.os == 'windows') {
            ext.libraries = [ 'matrixssl.lib' ]
        } else {
            ext.libraries = [ 'matrixssl' ]
        }
    },
    description: 'MatrixSSL',
}
</pre>
        <p>When generating projects, the <em>config</em> property function will not be invoked nor will any
            extension <em>path</em> property functions be called.</p>
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->
	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2014. 
            All rights reserved. Embedthis MakeMe, Ejscript and Appweb are trademarks of Embedthis Software LLC.</a>
		</p>
	</div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> 
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
        var customSearchControl = new google.search.CustomSearchControl(
          'partner-pub-9935546676162772:ysvxxv4n9rx');

        customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
        var options = new google.search.DrawOptions();
        options.enableSearchboxOnly("http://embedthis.com/search.html");
        customSearchControl.draw('cse-search-form', options);
      }, true);
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-179169-5']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
