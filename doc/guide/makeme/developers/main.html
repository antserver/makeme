<!-- BeginDsi "dsi/head.html" -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedthis MakeMe 0.8.0 Documentation</title>
    <meta name="keywords" content="MakeMe, Bit, GYP, autoconf"/>
	<meta name="description" content="Embedthis MakeMe -- Fast, modern replacement for make and autoconf."/>
	<meta name="robots" content="index,follow" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    </![endif]-->
    <link href="http://www.google.com/cse/style/look/default.css" type="text/css" rel="stylesheet" />
</head>

<body>
    <div class="top">
        <a class="logo"  href="http://embedthis.com/">&nbsp;</a>
        <div class="topRight">
            <div class="search">
                <div id="cse-search-form">Loading</div>
                <div class="version">Embedthis MakeMe 0.8.0</div>
            </div>
        </div>
        <div class="crumbs">
            <a href="../../../index.html">Home</a>
<!-- EndDsi -->
             &gt;<a href="index.html">Developer Guide</a>&gt; <b>Creating Main.me</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            
                <h1>Quick Nav </h1>
                <ul>
                    <li><a href="#configure">Creating</a></li>
                    <li><a href="#settings">Settings</a></li>
                    <li><a href="#usage">Usage Message</a></li>
                    <li><a href="#samples">Samples</a></li>
                </ul>
<!-- BeginDsi "dsi/devSeeAlso.html" -->
            <h1>See Also</h1>
            <ul>
                <li><a href="../../../guide/makeme/developers/index.html">Dev Guide</a></li>
                <li><a href="../../../guide/makeme/developers/projects.html">MakeMe Projects</a></li>
                <li><a href="../../../guide/makeme/developers/compiling.html">Compiling Sources</a></li>
                <li><a href="../../../guide/makeme/developers/libraries.html">Creating Libraries</a></li>
                <li><a href="../../../guide/makeme/developers/executables.html">Building Executables</a></li>
                <li><a href="../../../guide/makeme/developers/scripts.html">Running Scripts</a></li>
                <li><a href="../../../guide/makeme/developers/copying.html">Copying Files</a></li>
                <li><a href="../../../guide/makeme/developers/main.html">Creating Main.me</a></li>
                <li><a href="../../../guide/makeme/developers/extensions.html">Creating Project Extensions</a></li>
                <li><a href="../../../guide/makeme/developers/generating.html">Generating Projects</a></li>
                <li><a href="../../../guide/makeme/developers/samples.html">MakeMe Samples</a></li>

                <li><a href="http://ejscript.org/products/ejs/doc/api/ejscript/index.html">Ejscript Language</a></li>
                <li><a href="http://ejscript.org/products/ejs/doc/index.html">Ejscript Documentation</a></li>
            </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
        <h2>Creating a Main.me</h2>
        <p>MakeMe enables you to create highly configurable projects by supporting a configure phase for users to
        run before building the software. The configure phase allows the user to select desired product features and
        extensions to tailor the product for their local operating system and platform.</p>
        <p>Configurable projects are different from stand-alone MakeMe projects in that the <em>start.me</em> is generated based
        on a template MakeMe file called <em>main.me</em>. The main.me file supplies the full project definition including
        the list of targets to build and which extensions are valid for the project.</p>
        <p>For example, consider this is main.me definition:</p>
<pre>
Me.load({
    settings: {
        name: 'example',
        description: 'My Example Project',
        version: '1.0.0',
        extensions: {
            require:  [ 'ssl' ],
            discover: [ 'doxygen', 'man', 'man2html' ],
        }
    },
    targets: {
        libest: {
            type: 'lib',
            headers: [ 'src/*.h' ],
            sources: [ 'src/*.c' ],
        },
    },
})
</pre>
        <p>When the user runs <em>configure</em>: 
        <pre>me -configure .</pre>
        <p>MakeMe will create the following:</p>
        <ul>
            <li>A startup MakeMe file: <em>start.me</em></li>
            <li>A platform output directory of the form: <em>OS-ARCH-PROFILE</em></li>
            <li>A platform specific MakeMe file: <em>OS-ARCH-PROFILE.me</em></li>
            <li>A source definitions header:<em>me.h</em></li>
        </ul>
        <p>These files fully describe the desired build characteristics with the selected
        extensions and options. Subsequently when MakeMe is run, it loads the <em>start.me</em> file
        which in turn loads the <em>OS-ARCH-PROFILE</em> MakeMe file to direct the build.</p>
        <a name="configure"></a>
        <h2>Configure Script</h2>
        <p>To make it simpler, developers typically provide a <em>configure</em> script to invoke MakeMe with 
        the <em>configure</em> goal.</p>
<pre>
# configure script
me configure "$@"
</pre>
        <a name="extensions"></a>
        <h2>Product Extensions</h2>
        <p>The main.me file may specify required or optional extensions which augment the project. sExtensions are 
        existing tools on the users systems such as the "doxygen" documentation generator tool or 
        alternatively, extensions may be libraries or entire frameworks that are separately installed on the users system.
        For example: the ESP web framework or PHP. </p>
        <p>The main.me <em>extensions</em> property collection specifies the extensions for the project.
        For example, this is the Appweb extensions definition:</p>
        <pre>
settings: {
    extensions: {
        require:  [ 'osdep', 'http', 'mpr', 'pcre'],
        discover: ['cgi', 'dir', 'doxygen', 'dsi', 'esp', 'gzip', 'htmlmin', 'man', 
                   'man2html', 'mdb', 'ngmin', 'pak', 'pmaker', 'recess', 'ssl', 
                   'uglifyjs', 'utest', 'zip' ],
        omit:     [ 'ejs', 'matrixssl', 'openssl', 'nanossl', 'php', 'sqlite' ],
    },
},
</pre>
        <p>The <em>require</em> property specifies the extensions that are necessary for any build to succeed.
        The <em>discover</em> property defines the optional extensions that will be included if they are available 
        on the local system. The <em>omit</em> property specifies the extensions that are omitted by default, but may be
        specified by invoking configure with the <em>--with EXTENSION</em> option.</p>
        <h3>Discovering Extensions</h3>
        <p>Extensions are located by MakeMe via probe scripts. An extension probe is responsible for fully defining 
        where the extension resources are located and how targets should
        utilize the extension. This includes what libraries and source code headers it publishes. </p>
        <p>For example: consider the probe script for a rocket extension that creates a library called librocket:</p>
        <pre>
Me.extension({
    rocket: {
        description: 'Rocket Engine',
        libraries: [ 'librocket' ],
        includes: [ 'rocket.h' ],
        defines: [ 'SATURNV' ],
    },
})
</pre>
        <p>If the projects <em>main.me</em> specifies <em>librocket</em> in its <em>extensions</em> properties, this
        script will be run to include the rocket extension.</p> Targets can then utilize it by simpling adding
        "<em>rocket</em>" to their <em>extensions</em> property. The necessary libraries and compilation definitions will be
        automatically inherited. For example:</p>
        <pre>
targets: {
    spaceship: {
        type: 'exe',
        sources: [ '*.c' ],
        <b>extensions: [ 'rocket' ]</b>,
    },
}
</pre>
        <p>Some standard extension probes are 
        provided with the MakeMe product, for example: the compiler and linker probes. A project may suppliment these
        with additional extension probes in a local <em>makeme/probes</em> directory. Finally, if an extension is 
        packaged and installed using the
        <a href="http://embedthis.com/products/pak/">Pak</a> manager, the probe may be contained in the 
        extension's MakeMe file. 
        <p>See <a href="extensions">Creating Extensions</a> for more details about creating extension probes.</p>
        <a name="settings"></a>
        <h2>Settings</h2>
        <p>The other component of the configuration process is defining settings that the software and selected extensions
        will use when building and running. These options are defined in the <em>settings</em> collection an may 
        be modified via the <em>-set</em> option. For example:
        <pre>configure -set mpr.logging=true</pre>
        <p>The default settings are specified in the main.me file. For example:</p>
<pre>
settings: {
    mode: 'fast',
    mpr: {
        logging: true,
    },
},
</pre>
        <p>Note that settings may be nested inside other collections to any depth. In such cases the feature is selected
        using the normal dot notation.</p>
        <p>When MakeMe configures, it will convert every value in the settings collection into a definition in the
        me.h header. Dots are converted to underscores. For example: mpr.logging is converted to "ME_MPR_LOGGING".
        True|False values are converted to 1 or 0 as appropriate.</p>
        <a name="usage"></a>
        <h2>Usage Message</h2>
        <p>Developers can tailor the usage message emitted by MakeMe to describe the various configurable options.
        Users can get configuration help by invoking configure with a <em>help</em> target. For example:
<pre>
$ <b>configure help</b>
Usage: me [options] [targets|actions] ...
  Options:
  --benchmark  # Measure elapsed time
  ...
</pre>
        <p>Additional usage messages may be specified in main.me in the <em>usage</em> property collection. For example:
<pre>
usage: {
    'ejs.db':        'Enable database support, ejs.db (true|false)',                                   
    'ejs.mail':      'Enable mail support, ejs.mail (true|false)',
    'ejs.mapper':    'Enable database mapper support, ejs.mapper (true|false)',
},
</pre>
        <a name="samples"></a>
        <h2>Samples</h2>
        <p>The standard probes are a good source of samples for how to create probes. View in the repository at
        <a href="https://github.com/embedthis/makeme/tree/master/makeme/probes">MakeMe Probes</a>.</p>
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->
	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2014. 
            All rights reserved. Embedthis MakeMe, Ejscript and Appweb are trademarks of Embedthis Software LLC.</a>
		</p>
	</div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> 
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
        var customSearchControl = new google.search.CustomSearchControl(
          'partner-pub-9935546676162772:ysvxxv4n9rx');

        customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
        var options = new google.search.DrawOptions();
        options.enableSearchboxOnly("http://embedthis.com/search.html");
        customSearchControl.draw('cse-search-form', options);
      }, true);
    </script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-179169-5']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
